<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>BRUZI+ðŸ“º</title>

<style>
:root{
  --bg:#0b0b0f;
  --card:#16161d;
  --accent:#00e5ff;
  --btn:#1f1f2a;
  --text:#ffffff;
  --live:#00e676;
  --movie:#ff9100;
  --series:#ab47bc;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Arial,Helvetica,sans-serif;
}
header{
  padding:15px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
  background:#000;
  border-bottom:1px solid #222;
}
.container{
  padding:15px;
}
.buttons{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
}
button{
  background:var(--btn);
  color:#fff;
  border:none;
  border-radius:10px;
  padding:14px;
  font-size:16px;
  cursor:pointer;
}
button:hover{opacity:.85}
input[type=file],input[type=text]{
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:8px;
  border:none;
}
.list{
  margin-top:15px;
}
.item{
  padding:10px;
  border-radius:8px;
  margin-bottom:8px;
  background:var(--card);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.item span{
  font-size:14px;
}
.badge{
  padding:4px 8px;
  border-radius:6px;
  font-size:12px;
}
.live{background:var(--live);color:#000}
.movie{background:var(--movie);color:#000}
.series{background:var(--series);color:#000}
video{
  width:100%;
  margin-top:15px;
  border-radius:12px;
  background:#000;
}
.hidden{display:none}
</style>
</head>

<body>

<header>BRUZI+ðŸ“º</header>

<div class="container">

<div class="buttons">
  <button onclick="show('add')">Adicionar Lista</button>
  <button onclick="show('live')">Live TV</button>
  <button onclick="show('movies')">Movies</button>
  <button onclick="show('series')">Series</button>
  <button onclick="exportM3U()">Extrair Lista</button>
  <button onclick="resetAll()">Reset</button>
</div>

<!-- ADD LIST -->
<div id="add" class="hidden">
  <input type="file" accept=".m3u,.m3u8" onchange="loadFile(this)">
  <input type="text" placeholder="Ou URL da lista M3U" id="m3uUrl">
  <button style="margin-top:10px" onclick="loadUrl()">Carregar URL</button>
</div>

<video id="player" controls></video>

<div id="list" class="list"></div>

</div>

<script>
let channels=[];

function show(type){
  document.getElementById('add').classList.add('hidden');
  if(type==='add') document.getElementById('add').classList.remove('hidden');
  render(type);
}

function loadFile(input){
  const file=input.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=e=>parseM3U(e.target.result);
  reader.readAsText(file);
}

function loadUrl(){
  const url=document.getElementById('m3uUrl').value;
  if(!url)return alert('Informe a URL');
  fetch(url).then(r=>r.text()).then(parseM3U)
  .catch(()=>alert('Erro ao carregar URL'));
}

function parseM3U(data){
  channels=[];
  const lines=data.split('\n');
  let current={};
  lines.forEach(l=>{
    l=l.trim();
    if(l.startsWith('#EXTINF')){
      const name=l.split(',').pop();
      const group=(l.match(/group-title="([^"]+)"/)||[])[1]||'Live';
      current={name,group};
    }else if(l.startsWith('http')){
      current.url=l;
      channels.push(current);
      current={};
    }
  });
  localStorage.setItem('bruzi_channels',JSON.stringify(channels));
  render('live');
}

function render(type){
  const list=document.getElementById('list');
  list.innerHTML='';
  const data=JSON.parse(localStorage.getItem('bruzi_channels')||'[]');
  data.filter(c=>{
    if(type==='movies')return /movie|filme/i.test(c.group);
    if(type==='series')return /series/i.test(c.group);
    if(type==='live')return true;
    return true;
  }).forEach(c=>{
    const div=document.createElement('div');
    div.className='item';
    const badgeClass=
      /movie|filme/i.test(c.group)?'movie':
      /series/i.test(c.group)?'series':'live';
    div.innerHTML=`
      <span>${c.name}</span>
      <span class="badge ${badgeClass}">${c.group}</span>
    `;
    div.onclick=()=>play(c.url);
    list.appendChild(div);
  });
}

function play(url){
  const v=document.getElementById('player');
  v.src=url;
  v.play();
}

function exportM3U(){
  if(!channels.length)return alert('Nada para extrair');
  let m3u='#EXTM3U\n';
  channels.forEach(c=>{
    m3u+=`#EXTINF:-1 group-title="${c.group}",${c.name}\n${c.url}\n`;
  });
  const blob=new Blob([m3u],{type:'text/plain'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='bruzi_extraido.m3u';
  a.click();
}

function resetAll(){
  localStorage.clear();
  channels=[];
  document.getElementById('list').innerHTML='';
  document.getElementById('player').src='';
}
</script>

</body>
  </html>
