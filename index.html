<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>BRUZI+ ðŸ“º</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;background:#000;color:#fff;font-family:Arial}
header{padding:12px;background:#111;display:flex;justify-content:space-between}
button,input{border:0;border-radius:6px}
button{background:#b00020;color:#fff;padding:12px;cursor:pointer}
input{padding:10px;width:100%;margin:6px 0}
#menu{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:15px}
.card{background:#1a1a1a;padding:20px;text-align:center;border-radius:12px}
.card:hover{background:#b00020}
#viewer{display:none;padding:10px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px}
.item{background:#111;border-radius:8px;overflow:hidden}
.item img{width:100%;height:150px;object-fit:cover}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);display:none;align-items:center;justify-content:center}
.box{background:#111;padding:20px;border-radius:12px;width:90%;max-width:400px}
video{width:100%;height:100%;background:#000}
</style>
</head>

<body>

<header>
  <b>BRUZI+ ðŸ“º</b>
  <span id="status">OFF</span>
</header>

<div id="menu">
  <div class="card" onclick="openLogin()">Adicionar Lista</div>
  <div class="card" onclick="show('TV')">Live TV</div>
  <div class="card" onclick="show('MOVIE')">Movies</div>
  <div class="card" onclick="show('SERIES')">Series</div>
  <div class="card" onclick="showFav()">Favoritos</div>
  <div class="card" onclick="resetAll()">Reset</div>
</div>

<div id="viewer">
  <button onclick="viewer.style.display='none'">Voltar</button>
  <div id="grid" class="grid"></div>
</div>

<div id="player" class="modal" onclick="player.style.display='none'"></div>

<div id="login" class="modal">
  <div class="box">
    <h3>Adicionar Lista</h3>

    <p><b>ðŸ“‚ Arquivo M3U (FUNCIONA 100%)</b></p>
    <input type="file" accept=".m3u,.m3u8" onchange="loadFile(this.files[0])">

    <hr>

    <p><b>XC Login</b></p>
    <input id="host" placeholder="http://servidor:porta">
    <input id="user" placeholder="UsuÃ¡rio">
    <input id="pass" placeholder="Senha">

    <button onclick="loadXC()">ATIVAR</button>
    <p onclick="login.style.display='none'" style="color:#888">Cancelar</p>
  </div>
</div>

<script>
let canais=[],fav=JSON.parse(localStorage.getItem("fav")||"[]");

function openLogin(){login.style.display="flex"}
function resetAll(){localStorage.clear();location.reload()}

function parse(data){
  canais=[];
  let temp=null;
  data.split(/\r?\n/).forEach(l=>{
    l=l.trim();
    if(l.startsWith("#EXTINF")){
      temp={
        n:l.split(",").pop().trim(),
        g:(l.match(/group-title="([^"]+)"/i)?.[1]||"TV").toUpperCase(),
        lg:l.match(/tvg-logo="([^"]+)"/i)?.[1]||"",
        u:""
      };
    }else if(temp && l.startsWith("http")){
      temp.u=l;
      canais.push(temp);
      temp=null;
    }
  });
  status.innerText="ONLINE "+canais.length;
}

function loadFile(file){
  const r=new FileReader();
  r.onload=e=>{
    parse(e.target.result);
    login.style.display="none";
  };
  r.readAsText(file);
}

function loadXC(){
  if(!host.value||!user.value||!pass.value) return;
  fetch(`${host.value}/get.php?username=${user.value}&password=${pass.value}&type=m3u_plus`)
    .then(r=>r.text())
    .then(t=>{
      parse(t);
      login.style.display="none";
    })
    .catch(()=>alert("Servidor bloqueou navegador â€” use arquivo M3U ou APK"));
}

function show(tipo){
  viewer.style.display="block";
  grid.innerHTML="";
  canais.filter(c=>c.g.includes(tipo)).slice(0,200).forEach(c=>{
    grid.innerHTML+=`
    <div class="item" onclick="play('${c.u}')">
      <img src="${c.lg}" onerror="this.src='https://via.placeholder.com/150'">
      <div style="padding:5px">${c.n}</div>
    </div>`;
  });
}

function play(u){
  player.style.display="flex";
  player.innerHTML=`<video src="${u}" controls autoplay></video>`;
}

function showFav(){
  viewer.style.display="block";
  grid.innerHTML="";
  canais.filter(c=>fav.includes(c.n)).forEach(c=>{
    grid.innerHTML+=`<div class="item">${c.n}</div>`;
  });
}
</script>

</body>
</html>
