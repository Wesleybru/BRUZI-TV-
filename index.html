<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4K IPTV PLAYER PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: radial-gradient(circle, #2a0202 0%, #05010a 100%); color: white; font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; }
        .container { display: flex; flex-direction: column; height: 100%; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .logo { font-size: 26px; font-weight: 800; color: #00d4ff; text-transform: uppercase; }
        .main-menu { display: grid; grid-template-columns: 1.5fr 1fr 1fr; grid-template-rows: repeat(3, 1fr); gap: 12px; flex-grow: 1; }
        .menu-item { background: #4a0000; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); }
        .menu-item:hover { background: #b00020; border-color: gold; }
        .live { grid-row: span 2; background: #800000; }
        #pl-status { font-size: 11px; padding: 5px 10px; border-radius: 20px; background: rgba(0,0,0,0.5); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 3000; align-items: center; justify-content: center; }
        .modal-content { background: #222; padding: 25px; border-radius: 15px; width: 90%; max-width: 400px; border: 1px solid #b00020; }
        .btn { width: 100%; padding: 12px; background: #b00020; border: none; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 5px; border: none; background: #333; color: white; width: 100%; }
        #viewer { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #05010a; z-index: 2000; overflow-y: auto; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; }
        .card { background: #1a1a1a; border-radius: 8px; overflow: hidden; border: 1px solid #333; font-size: 10px; text-align: center; }
        .card img { width: 100%; height: 150px; object-fit: cover; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="logo">4K<span> IPTV</span></div>
        <div id="pl-status">âšª Offline</div>
    </div>
    <div class="main-menu">
        <div class="menu-item live" onclick="exibir('TV')"><i class="fas fa-tv"></i><span>Live</span></div>
        <div class="menu-item" onclick="exibir('MOVIE')"><i class="fas fa-play-circle"></i><span>Movies</span></div>
        <div class="menu-item" onclick="alert('v3.5 Pro')"><i class="fas fa-cog"></i><span>Settings</span></div>
        <div class="menu-item" onclick="exibir('SERIES')"><i class="fas fa-list"></i><span>Series</span></div>
        <div class="menu-item" onclick="location.reload()"><i class="fas fa-sync-alt"></i><span>Reload</span></div>
        <div class="menu-item" onclick="document.getElementById('mAdd').style.display='flex'"><i class="fas fa-user-circle"></i><span>Account</span></div>
        <div class="menu-item" style="background: #222;" onclick="localStorage.clear();location.reload();"><i class="fas fa-sign-out-alt"></i><span>Exit</span></div>
    </div>
</div>

<div id="viewer">
    <button onclick="document.getElementById('viewer').style.display='none'" class="btn" style="width: 100px;">VOLTAR</button>
    <div id="grid" class="grid" style="margin-top:20px;"></div>
</div>

<div id="mAdd" class="modal">
    <div class="modal-content">
        <h3>Sincronizar Lista</h3>
        <input type="text" id="urlIn" placeholder="Cole sua URL M3U...">
        <button class="btn" onclick="salvar()">CONECTAR</button>
        <button class="btn" style="background:#444" onclick="document.getElementById('mAdd').style.display='none'">CANCELAR</button>
    </div>
</div>

<script>
    let canais = [];
    function salvar() { const u = document.getElementById('urlIn').value; if(u){localStorage.setItem('u', u); location.reload();} }

    async function carregar() {
        const u = localStorage.getItem('u');
        if(!u) return;
        const status = document.getElementById('pl-status');
        status.innerText = "ðŸ”µ Conectando...";

        // TENTATIVA 1: Proxy Direto
        try {
            const r = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent(u));
            const j = await r.json();
            parsear(j.contents);
        } catch(e) {
            // TENTATIVA 2: Backup Proxy
            try {
                const r2 = await fetch('https://corsproxy.io/?' + encodeURIComponent(u));
                const t2 = await r2.text();
                parsear(t2);
            } catch(e2) {
                status.innerText = "ðŸ”´ Erro CrÃ­tico";
                status.style.color = "red";
            }
        }
    }

    function parsear(data) {
        const linhas = data.split('\n');
        let obj = null;
        linhas.forEach(l => {
            if(l.startsWith('#EXTINF:')) {
                const n = l.split(',')[1] || "Canal";
                const lg = l.match(/tvg-logo="([^"]+)"/)?.[1] || "";
                const g = l.match(/group-title="([^"]+)"/)?.[1] || "Canais";
                obj = { n, lg, g: g.toUpperCase() };
            } else if(l.startsWith('http') && obj) {
                obj.u = l.trim();
                canais.push(obj);
                obj = null;
            }
        });
        document.getElementById('pl-status').innerText = "ðŸŸ¢ Online: " + canais.length;
        document.getElementById('pl-status').style.color = "lime";
    }

    function exibir(t) {
        document.getElementById('viewer').style.display = 'block';
        const g = document.getElementById('grid');
        g.innerHTML = "";
        const f = canais.filter(i => i.g.includes(t) || (t === 'TV' && !i.g.includes('MOVIE') && !i.g.includes('SERIE')));
        f.slice(0, 100).forEach(i => {
            g.innerHTML += `<div class="card"><img src="${i.lg || 'https://via.placeholder.com/150x200?text=TV'}"><div>${i.n}</div></div>`;
        });
    }
    carregar();
</script>
</body>
</html>
