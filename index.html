<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4K IPTV PLAYER PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: radial-gradient(circle, #2a0202 0%, #05010a 100%); color: white; font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; }
        .container { display: flex; flex-direction: column; height: 100%; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .logo { font-size: 24px; font-weight: 800; color: #00d4ff; text-transform: uppercase; }
        .main-menu { display: grid; grid-template-columns: 1.5fr 1fr 1fr; grid-template-rows: repeat(3, 1fr); gap: 10px; flex-grow: 1; }
        .menu-item { background: #4a0000; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); }
        .menu-item:hover { background: #b00020; border-color: gold; transform: scale(1.02); }
        .live { grid-row: span 2; background: #800000; }
        #pl-status { font-size: 11px; padding: 5px 10px; border-radius: 20px; background: rgba(0,0,0,0.8); border: 1px solid gold; color: gold; font-weight: bold; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 3000; align-items: center; justify-content: center; }
        .modal-content { background: #222; padding: 25px; border-radius: 15px; width: 90%; max-width: 400px; border: 1px solid #b00020; }
        .btn { width: 100%; padding: 12px; background: #b00020; border: none; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 5px; border: none; background: #333; color: white; }
        #viewer { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #05010a; z-index: 2000; overflow-y: auto; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; }
        .card { background: #1a1a1a; border-radius: 8px; overflow: hidden; border: 1px solid #333; font-size: 10px; text-align: center; }
        .card img { width: 100%; height: 150px; object-fit: cover; background: #000; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="logo">4K<span> IPTV</span></div>
        <div id="pl-status">âšª Sem Lista</div>
    </div>
    <div class="main-menu">
        <div class="menu-item live" onclick="exibir('TV')"><i class="fas fa-tv" style="font-size:40px; margin-bottom:10px;"></i><span>Live</span></div>
        <div class="menu-item" onclick="exibir('MOVIE')"><i class="fas fa-play-circle" style="font-size:30px; margin-bottom:10px;"></i><span>Movies</span></div>
        <div class="menu-item" onclick="alert('ConfiguraÃ§Ãµes 3.5 Ativas')"><i class="fas fa-cog" style="font-size:30px; margin-bottom:10px;"></i><span>Settings</span></div>
        <div class="menu-item" onclick="exibir('SERIES')"><i class="fas fa-list" style="font-size:30px; margin-bottom:10px;"></i><span>Series</span></div>
        <div class="menu-item" onclick="location.reload()"><i class="fas fa-sync-alt" style="font-size:30px; margin-bottom:10px;"></i><span>Reload</span></div>
        <div class="menu-item" onclick="document.getElementById('mAdd').style.display='flex'"><i class="fas fa-user-circle" style="font-size:30px; margin-bottom:10px;"></i><span>Account</span></div>
        <div class="menu-item" style="background: #222;" onclick="localStorage.clear();location.reload();"><i class="fas fa-sign-out-alt" style="font-size:30px; margin-bottom:10px;"></i><span>Exit</span></div>
    </div>
</div>

<div id="viewer">
    <button onclick="document.getElementById('viewer').style.display='none'" class="btn" style="width: 100px; margin-bottom: 20px;">VOLTAR</button>
    <div id="grid" class="grid"></div>
</div>

<div id="mAdd" class="modal">
    <div class="modal-content">
        <h3>Account / Playlist</h3>
        <input type="text" id="urlIn" placeholder="Cole sua URL M3U aqui...">
        <button class="btn" onclick="salvar()">SINCRONIZAR</button>
        <button class="btn" style="background:#444" onclick="document.getElementById('mAdd').style.display='none'">VOLTAR</button>
    </div>
</div>

<script>
    let canais = [];
    function salvar() { 
        const u = document.getElementById('urlIn').value.trim(); 
        if(u){ localStorage.setItem('iptv_url', u); location.reload(); } 
    }

    async function carregar() {
        const u = localStorage.getItem('iptv_url');
        if(!u) return;
        const status = document.getElementById('pl-status');
        status.innerText = "â³ Sincronizando...";

        // NOVO MOTOR DE CONEXÃƒO BYPASS
        const proxy = "https://api.codetabs.com/v1/proxy?quest=";
        
        try {
            const res = await fetch(proxy + encodeURIComponent(u));
            const data = await res.text();
            
            if(!data.includes('#EXTM3U')) throw new Error();

            const linhas = data.split('\n');
            let item = null;
            linhas.forEach(l => {
                if(l.startsWith('#EXTINF:')) {
                    const n = l.split(',')[1] || "Canal";
                    const lg = l.match(/tvg-logo="([^"]+)"/)?.[1] || "";
                    const g = l.match(/group-title="([^"]+)"/)?.[1] || "Canais";
                    item = { n, lg, g: g.toUpperCase() };
                } else if(l.startsWith('http') && item) {
                    item.u = l.trim();
                    canais.push(item);
                    item = null;
                }
            });
            status.innerText = "ðŸŸ¢ Online: " + canais.length;
            status.style.color = "#00ff00";
        } catch(e) {
            status.innerText = "ðŸ”´ Link Recusado";
            status.style.color = "red";
        }
    }

    function exibir(t) {
        document.getElementById('viewer').style.display = 'block';
        const g = document.getElementById('grid');
        g.innerHTML = "";
        const f = canais.filter(i => i.g.includes(t) || (t === 'TV' && !i.g.includes('MOVIE') && !i.g.includes('SERIE')));
        f.slice(0, 150).forEach(i => {
            g.innerHTML += `<div class="card" onclick="alert('Abrindo stream...')"><img src="${i.lg || 'https://via.placeholder.com/150x200?text=TV'}"><div>${i.n}</div></div>`;
        });
    }
    carregar();
</script>
</body>
</html>
